---
layout: post
title: "2.使用窗函数设计FIR滤波器"
date: 2013-05-24 14:25:02 +0800
tags: 数字信号处理
# categories: jekyll update
---

在上一篇文章中，我们介绍了FIR滤波器的基本概念和实现方法。本文将继续深入探讨FIR滤波器的设计方法，特别是使用窗函数法进行设计的过程。

窗函数法是FIR滤波器设计中最常用的方法之一。这种方法首先从理想滤波器的单位冲激响应出发，然后通过窗函数将其截断为有限长度，从而得到实际可实现的FIR滤波器。虽然这种方法会引入一些不理想的特性（如纹波和过渡带），但通过合理选择窗函数和参数，我们可以在性能和复杂度之间取得良好的平衡。

在进行FIR滤波器设计之前，我们需要深入理解滤波器频率响应特性中的几个核心概念。这些概念对于理解和评估滤波器性能至关重要。让我们通过下图来详细分析这些关键参数：

<div align=center><img src="{{ site.baseurl }}/assets/Design-FIR-Filter-Window-Function/Design-FIR-Filter-1.jpeg" width="400"></div>

首先，让我们详细解析滤波器的各个频带区域：

- 通带（Passband）：频率范围$[0, \omega_p]$，这是我们希望信号能够无失真通过的频率区间。
- 通带纹波（Passband Ripple）：范围$[1-\delta_p, 1+\delta_p]$，表示通带内幅频特性的允许波动范围。这个参数直接影响着通带信号的保真度。
- 阻带（Stopband）：频率范围$[\omega_s, \pi]$，在此区间内的频率分量应被显著衰减。
- 阻带纹波（Stopband Ripple）：范围$[0, \delta_s]$，定义了阻带内允许的最大衰减量。这个参数决定了滤波器对不需要频率的抑制能力。
- 过渡带（Transition Band）：图中的黑色区域，是通带到阻带的过渡区域。其中$\omega_p$是通带截止频率，$\omega_s$是阻带起始频率。过渡带的宽度直接影响着滤波器的阶数和复杂度。

在滤波器设计过程中，上述参数规格需要根据应用要求进行明确定义，并作为设计约束条件。需要指出的是，上述参数定义基于低通滤波器，对于高通或带通滤波器，这些参数的定义方式则需要相应调整。在实际设计中，还需要综合考虑系统要求与硬件资源，以实现滤波器性能的最优化。

&nbsp;
## 理想FIR低通滤波器
在FIR滤波器设计中，我们首先需要分析理想低通滤波器的频率响应特性。理想低通滤波器的频率响应函数可表示为：

$$
\begin{aligned}

H(e^{(j\omega)}) = \left \{
\begin{array}{l}
1, \hspace{3mm} |\omega| \leq \omega_c \\
0, \hspace{3mm} otherwide \\
\end{array}
\right.

\end{aligned}
$$

其中，$\omega_c [rad]=\frac{\omega_p+\omega_s}{2}$ 为截止频率，该频率定义了通带与阻带的分界点。

为了获得滤波器的系数，我们需要求解其单位冲激响应。通过对理想频率响应进行离散时间傅里叶逆变换，可得到如下推导过程：

$$
\begin{aligned}
h_d(n) &= \frac{1}{2\pi} \int_{-\omega_c}^{\omega_c} 1 \cdot e^{j\omega n} d\omega \\
       &= \frac{1}{2\pi} \cdot \frac{1}{jn} \int_{-\omega_c}^{\omega_c} e^{j\omega n} d\omega \\
       &= \frac{1}{n\pi} \cdot \frac{e^{j \omega_c n} - e^{-j \omega_c n}}{2j} \\ 
       &= \frac{sin(\omega_c n)}{\pi n} \\
       &= \frac{\omega_c}{\pi} sinc(\frac{\omega_c}{\pi}n), \hspace{3mm} n \in (-\infty, +\infty)
\end{aligned}
$$

通过上述推导，我们获得了理想低通滤波器的单位冲击响应表达式，其中sinc函数为辛格函数。这个表达式的特性值得我们进行深入分析。

从数学角度考察该表达式的性质：首先，该表达式是离散的，这与数字滤波器的离散特性相符合。然而，进一步分析发现，该表达式描述的单位冲击响应序列是无限长的。这一特性导致了一个重要结论：严格意义上的理想低通滤波器在实际系统中是无法实现的。

基于工程实践的需求，我们需要采用近似方法来实现滤波器。具体而言，我们可以从理想滤波器的无限长单位冲击响应中截取有限长度的序列，通过适当的处理构造出一个近似的实际滤波器。这种方法虽然会导致滤波器性能的某些降低，但可以满足实际应用的要求。

这就引出了一个关键问题：如何从无限长序列中选取有限长度的部分，使得所设计的滤波器能够最大程度地满足系统指标要求？一个有效的解决方案是使用窗函数（Window Function）。窗函数可以帮助我们从无限长的理想单位冲激响应中截取出有限长度的序列，并通过适当的加权来减少截断带来的负面影响。通过选择合适的窗函数类型和长度，我们可以在滤波器性能和计算复杂度之间取得良好的平衡。

&nbsp;
## 窗函数
在分析理想单位冲击响应的特性时，我们可以观察到其具有显著的数学特征。该响应在$n=0$处呈现最大值，并随着$n$值的增大而呈现对称衰减的特性，同时伴随着正负交替的振荡。从工程实现的角度考虑，为了在保持滤波器主要特性的同时实现有限长度的设计目标，我们需要对该无限长序列进行截断。基于能量分布的分析，保留中心区域的主要能量分量，同时舍弃远端的低能量部分是一种合理的工程折衷方案。这种截断操作可以通过如下数学表达式来实现。

$$
\begin{aligned}

\omega(n) = \left \{
\begin{array}{l}
1, \hspace{3mm} |n| \leq \frac{N-1}{2} \\
0, \hspace{3mm} otherwide \\
\end{array}
\right.

\end{aligned}
$$

上述表达式定义了一个矩形窗函数，用于从无限长序列中截取有限长度的数据段。窗函数的长度参数$N$直接影响滤波器的性能特性 - 随着$N$的增大，滤波器的频率响应将更加接近理想特性。

将窗函数应用于原始序列的过程称为加窗处理，其本质是对序列进行逐点相乘运算。具体的数学表达如下：

$$
\begin{aligned}
h_d(n) &= h_d(n) \cdot \omega(n) \\
       &= \frac{\omega_c}{\pi} sinc(\frac{\omega_c}{\pi}n) \cdot \omega(n), \hspace{3mm} n \in \left(-\frac{N-1}{2}, +\frac{N-1}{2} \right)
\end{aligned}
$$

通过上述加窗处理，我们完成了从理想滤波器到实际可实现滤波器的关键转换步骤。

值得注意的是，虽然矩形窗是最简单的窗函数形式，但在工程实践中较少采用。这主要是由于其阻带衰减性能较差，仅能达到$21[dB]$的衰减水平，往往无法满足实际系统的要求。为了克服这一局限性，信号处理领域发展出了多种具有不同特性的窗函数。在滤波器设计的初期阶段，阻带衰减通常是我们评估窗函数性能的核心指标。下面我们将对几种常用窗函数的性能特性进行对比分析。

| 窗函数       | 过渡带大小    |  阻带衰减   |
| ----------- | ----------- |----------- |
|   矩形窗     | $1.8\pi/N$  |   $21[dB]$ |
|   汉宁窗     | $6.2\pi/N$  |   $44[dB]$ |
|   汉明窗     | $6.6\pi/N$  |   $58[dB]$ |
| 布莱克曼窗    | $11\pi/N$  |   $74[dB]$ |


&nbsp;
## 用窗函数实现一个FIR滤波器
基于前述对窗函数原理的分析，现总结FIR滤波器的系统设计流程如下：

1. 依据系统规格要求，选择适当的窗函数。在此阶段，阻带衰减是关键指标，必须确保其满足设计要求。若规格中未直接给出阻带衰减指标，则需通过通带纹波与阻带纹波参数进行如下计算：

$$
\begin{aligned}
R_p &= -20 \cdot log_{10}\frac{1  - \delta_p}{1  + \delta_p} \\
A_s &= -20 \cdot log_{10}\frac{\delta_s}{1  + \delta_p} \\
\end{aligned}
$$

2. 基于通带边缘频率与阻带起始频率，计算过渡带宽度，进而确定所需窗函数长度。
3. 根据所选窗函数及理想滤波器的单位冲击响应特性，计算实际滤波器的单位冲击响应系数。
让我们通过一个具体的设计实例来深入理解窗函数法的应用。假设我们需要设计一个满足以下指标的FIR低通滤波器：
- 通带边缘频率 $\omega_p=\frac{\pi}{3}[rad]$
- 通带纹波 $\delta_p=0.1$
- 阻带起始频率 $\omega_s=\frac{\pi}{2}[rad]$
- 阻带纹波 $\delta_s=0.01$

由于规格中未直接给出阻带衰减要求，我们需要通过通带纹波和阻带纹波参数进行计算：

$$
\begin{aligned}
R_p &= -20 \cdot log_{10}\frac{1  - \delta_p}{1  + \delta_p} = 1.743[dB] \\
A_s &= -20 \cdot log_{10}\frac{\delta_s}{1  + \delta_p} = 40.828[dB] \\
\end{aligned}
$$

计算结果表明，所需的阻带衰减为$40.8[dB]$。根据前文的窗函数性能对比表，虽然汉宁窗的$44[dB]$阻带衰减已经满足要求，但为了获得更好的性能裕度，我们选择使用汉明窗进行设计。

接下来计算所需的窗函数长度。根据通带和阻带频率，可得：

$$
\begin{aligned}
\Delta \omega &= \omega_s - \omega_p = \frac{\pi}{2} - \frac{\pi}{3} = \frac{\pi}{6} \\ 
N &= \frac{6.6 \pi}{\Delta \omega} = \frac{6.6 \pi}{ \frac{\pi}{6} } = 39.6 \\
\end{aligned}
$$

确定窗长度后，我们可以得到滤波器的单位冲击响应表达式：

$$
\begin{aligned}
h_d(n) &= h_d(n) \cdot \omega(n) \\
       &= \frac{\omega_c}{\pi} sinc(\frac{\omega_c}{\pi}n) \cdot \omega(n), \hspace{3mm} n \in \left(-\frac{N-1}{2}, +\frac{N-1}{2} \right) \\

\omega (n) &= 0.54 + 0.46 \cdot cos \frac{2\pi}{N-1}

\end{aligned}
$$

至此，我们完成了FIR滤波器的理论设计。该滤波器的单位冲击响应如下图所示：

<div align=center><img src="{{ site.baseurl }}/assets/Design-FIR-Filter-Window-Function/Design-FIR-Filter-2.jpeg" width="400"></div>


&nbsp;
## 结论
通过上述理论分析，我们完成了FIR滤波器的初步设计，并获得了其单位脉冲响应的理论表达式。

然而，从系统实现的角度来看，该设计方案存在一个关键性问题：通过理论计算可以证明，所得到的滤波器系统是非因果的，这在实际工程应用中是无法实现的。

这个问题源于理想滤波器的非因果特性。在实际系统设计中，需要采取适当的措施来解决这一问题。关于具体的解决方案以及相应的FIR滤波器设计代码实现，将在下一节中进行详细讨论。


&nbsp;
&nbsp;
<div style="font-size:16px">
    <span style="float:right"> 
        <a href="{{ site.baseurl }}/2013/05/29/FIR-Filter-Design-2"> [下一回] >> </a>
    </span>　
        <a href="{{ site.baseurl }}/2013/05/23/FIR-Filter"> << [上一回] </a>
</div>